<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bangla Fast Chat</title>
    <!-- MQTT ‡¶≤‡¶æ‡¶á‡¶¨‡ßç‡¶∞‡ßá‡¶∞‡¶ø (CDN ‡¶•‡ßá‡¶ï‡ßá) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js" type="text/javascript"></script>
    
    <style>
        /* --- ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® --- */
        body { background: #121212; color: white; font-family: sans-serif; display: flex; flex-direction: column; height: 100vh; margin: 0; }
        
        /* ‡¶®‡¶æ‡¶Æ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® */
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #121212; z-index: 100; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .box { background: #1e1e1e; padding: 30px; border-radius: 10px; width: 80%; max-width: 300px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        input { width: 90%; padding: 12px; margin: 10px 0; border-radius: 5px; border: none; background: #333; color: white; text-align: center; }
        button { width: 100%; padding: 12px; background: #00e676; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; color: black; }
        
        /* ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® */
        #chat-screen { display: none; flex-direction: column; height: 100%; }
        header { background: #1e1e1e; padding: 15px; text-align: center; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
        .status { width: 10px; height: 10px; border-radius: 50%; background: red; display: inline-block; }
        .online { background: #00e676; box-shadow: 0 0 10px #00e676; }

        #messages { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .msg { max-width: 75%; padding: 8px 12px; border-radius: 15px; font-size: 14px; word-wrap: break-word; }
        .my-msg { align-self: flex-end; background: #00e676; color: black; border-bottom-right-radius: 2px; }
        .other-msg { align-self: flex-start; background: #333; color: white; border-bottom-left-radius: 2px; }
        .sender-name { font-size: 10px; font-weight: bold; display: block; margin-bottom: 2px; opacity: 0.7; }

        .input-area { background: #1e1e1e; padding: 10px; display: flex; gap: 10px; }
        #msg-input { flex: 1; padding: 10px; border-radius: 20px; background: #333; border: none; color: white; outline: none; }
        #send-btn { background: #00e676; border: none; width: 40px; height: 40px; border-radius: 50%; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <!-- ‡ßß. ‡¶≤‡¶ó‡¶ø‡¶® ‡¶™‡ßá‡¶ú -->
    <div id="login-screen">
        <div class="box">
            <h2>üöÄ Fast Chat</h2>
            <input type="text" id="username" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
            <button onclick="enterChat()">Start Chat</button>
            <p id="status-text" style="font-size:12px; color:gray; margin-top:10px;">Server Status: Waiting...</p>
        </div>
    </div>

    <!-- ‡ß®. ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶™‡ßá‡¶ú -->
    <div id="chat-screen">
        <header>
            <span>Chat Room</span>
            <div><span id="status-dot" class="status"></span></div>
        </header>

        <div id="messages">
            <div style="text-align:center; font-size:12px; color:gray; margin-top:20px;">
                ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞‡ßá ‡¶ï‡¶æ‡¶®‡ßá‡¶ï‡ßç‡¶ü ‡¶π‡¶ö‡ßç‡¶õ‡ßá... ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§
            </div>
        </div>

        <div class="input-area">
            <input type="text" id="msg-input" placeholder="‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®...">
            <button id="send-btn" onclick="sendMessage()">‚û§</button>
        </div>
    </div>

    <script>
        // --- ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶∂‡¶® (HiveMQ Public Broker) ---
        const BROKER = "broker.hivemq.com";
        const PORT = 8000; // WebSocket Port
        const TOPIC = "bangla/chat/global/v99"; // ‡¶á‡¶â‡¶®‡¶ø‡¶ï ‡¶ü‡¶™‡¶ø‡¶ï ‡¶Ø‡¶æ‡¶§‡ßá ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶ï‡¶æ‡¶∞‡ßã ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶®‡¶æ ‡¶Ü‡¶∏‡ßá

        let client;
        let myName = "";

        // ‡ßß. ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü‡ßá ‡¶¢‡ßã‡¶ï‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        function enterChat() {
            myName = document.getElementById("username").value.trim();
            if (!myName) return alert("‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®!");

            document.getElementById("login-screen").style.display = "none";
            document.getElementById("chat-screen").style.display = "flex";

            connectMQTT();
        }

        // ‡ß®. ‡¶ï‡¶æ‡¶®‡ßá‡¶ï‡¶∂‡¶® ‡¶§‡ßà‡¶∞‡¶ø (‡¶Æ‡ßá‡¶á‡¶® ‡¶≤‡¶ú‡¶ø‡¶ï)
        function connectMQTT() {
            // ‡¶á‡¶â‡¶®‡¶ø‡¶ï ‡¶ï‡ßç‡¶≤‡¶æ‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶Ü‡¶á‡¶°‡¶ø ‡¶§‡ßà‡¶∞‡¶ø
            const clientId = "client-" + Math.floor(Math.random() * 100000);
            
            // Paho Client ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™
            client = new Paho.MQTT.Client(BROKER, PORT, clientId);

            // ‡¶ï‡¶≤‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
            client.onConnectionLost = onConnectionLost;
            client.onMessageArrived = onMessageArrived;

            // ‡¶ï‡¶æ‡¶®‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ
            client.connect({
                onSuccess: onConnect,
                onFailure: onFailure,
                useSSL: true // GitHub Pages ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø SSL ‡¶¨‡¶æ‡¶¶‡ßç‡¶ß‡¶§‡¶æ‡¶Æ‡ßÇ‡¶≤‡¶ï
            });
        }

        // ‡¶ï‡¶æ‡¶®‡ßá‡¶ï‡¶∂‡¶® ‡¶∏‡¶´‡¶≤ ‡¶π‡¶≤‡ßá
        function onConnect() {
            console.log("Connected to HiveMQ");
            document.getElementById("status-dot").classList.add("online");
            
            // ‡¶ü‡¶™‡¶ø‡¶ï ‡¶è ‡¶∏‡¶æ‡¶¨‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶æ‡¶á‡¶¨ ‡¶ï‡¶∞‡¶æ (‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶∂‡ßã‡¶®‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)
            client.subscribe(TOPIC);

            // ‡¶ì‡ßü‡ßá‡¶≤‡¶ï‡¶æ‡¶Æ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú
            const msgBox = document.getElementById("messages");
            msgBox.innerHTML = `<div style="text-align:center; font-size:12px; color:#00e676; margin:10px;">üü¢ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶æ‡¶®‡ßá‡¶ï‡ßç‡¶ü‡ßá‡¶°! ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡•§</div>`;
        }

        function onFailure(e) {
            console.log("Failed", e);
            alert("‡¶ï‡¶æ‡¶®‡ßá‡¶ï‡¶∂‡¶® ‡¶´‡ßá‡¶≤ ‡¶ï‡¶∞‡ßá‡¶õ‡ßá! ‡¶™‡ßá‡¶ú ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶¶‡¶ø‡¶®‡•§");
        }

        function onConnectionLost(responseObject) {
            if (responseObject.errorCode !== 0) {
                console.log("Connection Lost: " + responseObject.errorMessage);
                document.getElementById("status-dot").classList.remove("online");
                alert("‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶¨‡¶ø‡¶ö‡ßç‡¶õ‡¶ø‡¶®‡ßç‡¶® ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
            }
        }

        // ‡ß©. ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶Ü‡¶∏‡¶≤‡ßá ‡¶Ø‡¶æ ‡¶π‡¶¨‡ßá
        function onMessageArrived(message) {
            const payload = JSON.parse(message.payloadString);
            
            // ‡¶Ø‡¶¶‡¶ø ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶®‡¶ø‡¶ú‡ßá‡¶∞ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶π‡ßü, ‡¶§‡¶æ‡¶π‡¶≤‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßã ‡¶®‡¶æ (‡¶ï‡¶æ‡¶∞‡¶£ ‡¶Ü‡¶Æ‡¶ø ‡¶Ü‡¶ó‡ßá‡¶á ‡¶¶‡ßá‡¶ñ‡¶ø‡ßü‡ßá‡¶õ‡¶ø)
            // ‡¶§‡¶¨‡ßá ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶∏‡¶π‡¶ú ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡¶¨ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶∞‡¶ø‡¶∏‡¶ø‡¶≠ ‡¶ï‡¶∞‡ßá ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶õ‡¶ø
            if(payload.sender === myName) return; 

            displayMessage(payload.sender, payload.text, 'other');
        }

        // ‡ß™. ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã
        function sendMessage() {
            const input = document.getElementById("msg-input");
            const text = input.value.trim();
            
            if (!text) return;
            if (!client.isConnected()) return alert("‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞‡ßá ‡¶ï‡¶æ‡¶®‡ßá‡¶ï‡ßç‡¶ü‡ßá‡¶° ‡¶®‡ßá‡¶á!");

            // ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶∞‡ßá‡¶°‡¶ø ‡¶ï‡¶∞‡¶æ
            const messageData = JSON.stringify({ sender: myName, text: text });
            
            // ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã
            const message = new Paho.MQTT.Message(messageData);
            message.destinationName = TOPIC;
            client.send(message);

            // ‡¶®‡¶ø‡¶ú‡ßá‡¶∞ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
            displayMessage("‡¶Ü‡¶Æ‡¶ø", text, 'my');
            input.value = "";
        }

        // ‡ß´. ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶°‡¶ø‡¶∏‡¶™‡ßç‡¶≤‡ßá ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶®
        function displayMessage(sender, text, type) {
            const box = document.getElementById("messages");
            const div = document.createElement("div");
            
            div.className = `msg ${type === 'my' ? 'my-msg' : 'other-msg'}`;
            div.innerHTML = `
                <span class="sender-name">${sender}</span>
                ${text}
            `;
            
            box.appendChild(div);
            box.scrollTop = box.scrollHeight;
        }
    </script>
</body>
</html>
